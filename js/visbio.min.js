/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * vkBeautify - javascript plugin to pretty-print or minify text in XML, JSON, CSS and SQL formats.
 *
 * Version - 0.99.00.beta
 * Copyright (c) 2012 Vadim Kiryukhin
 * vkiryukhin @ gmail.com
 * http://www.eslinstructor.net/vkbeautify/
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 *   Pretty print
 *
 *        vkbeautify.xml(text [,indent_pattern]);
 *        vkbeautify.json(text [,indent_pattern]);
 *        vkbeautify.css(text [,indent_pattern]);
 *        vkbeautify.sql(text [,indent_pattern]);
 *
 *        @text - String; text to beatufy;
 *        @indent_pattern - Integer | String;
 *                Integer:  number of white spaces;
 *                String:   character string to visualize indentation ( can also be a set of white spaces )
 *   Minify
 *
 *        vkbeautify.xmlmin(text [,preserve_comments]);
 *        vkbeautify.jsonmin(text);
 *        vkbeautify.cssmin(text [,preserve_comments]);
 *        vkbeautify.sqlmin(text);
 *
 *        @text - String; text to minify;
 *        @preserve_comments - Bool; [optional];
 *                Set this flag to true to prevent removing comments from @text ( minxml and mincss functions only. )
 *
 *   Examples:
 *        vkbeautify.xml(text); // pretty print XML
 *        vkbeautify.json(text, 4 ); // pretty print JSON
 *        vkbeautify.css(text, '. . . .'); // pretty print CSS
 *        vkbeautify.sql(text, '----'); // pretty print SQL
 *
 *        vkbeautify.xmlmin(text, true);// minify XML, preserve comments
 *        vkbeautify.jsonmin(text);// minify JSON
 *        vkbeautify.cssmin(text);// minify CSS, remove comments ( default )
 *        vkbeautify.sqlmin(text);// minify SQL
 *
 */

/** histogram.js

     (c) Zachary King 2013

     TODO add update_size function.
     
     */

/** tooltip.js

     (c) Zachary King 2013

     TODO fix to update based on vis/resize.js
     */

(function(e,t){typeof define=="function"&&define.amd?define(t):e.visbio=t()})(this,function(){var e,t,n;return function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),w=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n.apply(a[e],g);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!w)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("lib/d3",[],function(){return window.d3===undefined&&console.error("d3 is not loaded."),window.d3}),n("vis/scaffold",["lib/d3"],function(e){function t(e,t){var n=parseFloat(e.style("width"))-t.left-t.right,r=parseFloat(e.style("height"))-t.top-t.bottom;return{width:n,height:r}}function n(e,t){var n=parseFloat(e.attr("width"))-t.left-t.right,r=parseFloat(e.attr("height"))-t.top-t.bottom;return{width:n,height:r}}function r(e,t){if(e===undefined)return t;var n=-1,r=t,i=window.Object.keys(e);while(++n<i.length)r[i[n]]=e[i[n]];return r}function i(r,i,s,o){var u=function(n,r,i){n&&(e.select("body").style("margin","0").style("padding","0"),r.style("height",window.innerHeight-i.top+"px"),r.style("width",window.innerWidth-i.left+"px"),r.style("margin-left",i.left+"px"),r.style("margin-top",i.top+"px"));var s=t(r,i);return s.svg=r.append("svg").attr("width",s.width).attr("height",s.height).attr("xmlns","http://www.w3.org/2000/svg"),s},a;return i?(a=n(r,s),a.svg=r):r?a=u(o,r,s):a=u(o,e.select("body").append("div"),s),(a.height<=0||a.width<=0)&&console.warn("Container has invalid height or width. Try setting styles for height and width, or use the 'fill_screen' option."),a}function s(e,r,i,s){function u(e,n,r){e&&(n.style("height",window.innerHeight-r.top+"px"),n.style("width",window.innerWidth-r.left+"px"),n.style("margin-left",r.left+"px"),n.style("margin-top",r.top+"px"));var s=t(n,i);return n.select("svg").attr("height",s.height).attr("width",s.width),s}var o;return r?o=n(e,i):e?o=u(s,e,i):console.warn("No selection"),o}function o(t,n){var r="";return t&&e.text(t,function(e,t){e&&console.warn(e),r=t,n(r)}),!1}function u(){return"omg yes"}function a(t,n,r){function i(e,t){return e.indexOf(t,e.length-t.length)!==-1}if(r){t&&console.log("file "+t+" overridden by value"),n("",r,t);return}if(!t){n("No filename",null,t);return}i(t,"json")?e.json(t,function(e,r){n(e,r,t)}):i(t,"css")?e.text(t,function(e,r){n(e,r,t)}):n("Unrecognized file type",null,t);return}function f(e,t){var n=-1,r=e.length,i={};while(++n<e.length){var s=e[n].file;i[s]=e[n].callback,a(s,function(e,n,s){i[s](e,n),--r||t()},e[n].value)}}function l(t,n,i,s,o){var u=r(o,{padding:{left:0,right:0,top:0,bottom:0},x_is_log:!1,y_is_log:!1,y_ticks:null,x_ticks:null,x_nice:!1,y_nice:!1,x_tick_format:null,y_tick_format:null}),a={};return u.x_is_log?a.x=e.scale.log():a.x=e.scale.linear(),a.x.range([u.padding.left,i-u.padding.right]).domain(t),n?(u.y_is_log?a.y=e.scale.log():a.y=e.scale.linear(),a.y.range([s-u.padding.bottom,1+u.padding.top]).domain(n)):a.y=null,t?(a.x_axis=e.svg.axis().scale(a.x).orient("bottom"),u.x_nice&&a.x_axis.nice(),u.x_ticks&&a.x_axis.ticks(u.x_ticks),u.x_tick_format&&a.x_axis.tickFormat(u.x_tick_format)):a.x=null,a.y_axis=e.svg.axis().scale(a.y).orient("left"),u.y_nice&&a.y_axis.nice(),u.y_ticks&&a.y_axis.ticks(u.y_ticks),u.y_tick_format&&a.y_axis.tickFormat(u.y_tick_format),a}function c(e,t,n,r,i,s,o){var u,a,f,l,c,h,p;return e=="x"?(u="x axis",a=[0,s-o.bottom],f=i,l=-6,p=0,c=0,h=0):e=="y"?(u="y axis",a=[o.left,0],f=0,l=6,p=-90,c=0,h=".71em"):console.warn("Bad axis type"),n.append("g").attr("class",u).attr("transform","translate("+a+")").call(r).append("text").attr("class","label").attr("transform","rotate("+p+")").attr("x",f).attr("y",l).attr("dx",c).attr("dy",h).style("text-anchor","end").text(t)}return{set_options:r,setup_svg:i,resize_svg:s,load_css:o,load_files:f,load_the_file:a,scale_and_axes:l,add_generic_axis:c}}),n("vis/bar",["./scaffold","lib/d3"],function(e,t){return function(n){function s(){return i=e.resize_svg(r.selection,r.selection_is_svg,r.margins,r.fill_screen),r.height=i.height,r.width=i.width,this}function o(){var n=-1;while(++n<r.layers.length)if(r.layers[n]===undefined)return console.log("waiting for all indices"),this;r.svg.select("#bar-container").remove();var i=r.svg.append("g").attr("id","bar-container");i.append("style").attr("type","text/css").text(r.css);var s=i.append("g").attr("transform","translate("+r.margins.left+","+r.margins.top+")"),o=[0,t.max(r.layers,function(e){return e.data.length})],u;if(r.y_range)u=r.y_range;else if(r.is_stacked){var n=-1,a=0;while(++n<r.layers[0].data.length){var f=-1,l=0;while(++f<r.layers.length)l+=r.layers[f].data[n].value;l>a&&(a=l)}u=[t.min(r.layers,function(e){return t.min(e.data,function(e){return e.value})}),a]}else u=[t.min(r.layers,function(e){return t.min(e.data,function(e){return e.value})}),t.max(r.layers,function(e){return t.max(e.data,function(e){return e.value})})];var c={y:u,x:o},h=e.scale_and_axes(c.x,c.y,r.width,r.height,{padding:r.plot_padding,x_ticks:0,y_ticks:5,y_tick_format:t.format("f")}),p=h.x,d=h.y;e.add_generic_axis("x",r.x_axis_label,s,h.x_axis,r.width,r.height,r.plot_padding),e.add_generic_axis("y",r.y_axis_label,s,h.y_axis,r.width,r.height,r.plot_padding);var v=0,m=p(2)-p(1)-v;for(var f=0;f<r.layers.length;f++){var g="bar"+String(f),y=s.selectAll("."+g).data(r.layers[f].data).enter().append("g").attr("class","bar "+g);r.is_stacked?f>0?y.attr("transform",function(e,t){return"translate("+p(t)+","+(d(r.layers[f-1].data[t].value)-(d(c.y[0])-d(e.value)))+")"}):y.attr("transform",function(e,t){return"translate("+p(t)+","+d(e.value)+")"}):y.attr("transform",function(e,t){return"translate("+(p(t)+r.x_shift*f)+","+d(e.value)+")"});var b=y.append("rect").attr("x",1).attr("width",m).attr("height",function(e){return d(c.y[0])-d(e.value)}).style("fill",function(e){return r.color_scale?r.color_scale(e.category):null})}return r.title&&s.append("text").attr("class","title").text(r.title).attr("transform","translate("+r.width/2+",10)").attr("text-anchor","middle"),r.update_hook&&r.update_hook(s),this}function u(e,t){r.ready||console.warn("Hasn't loaded css yet");if(r.data_is_object){var n=[];for(var i in e)n.push({name:i,value:e[i]});r.layers[t]={data:n}}else r.layers[t]={data:e};return o(),this}function a(e){return r.update_hook=e,this}var r=e.set_options(n,{margins:{top:10,right:10,bottom:10,left:20},plot_padding:{left:30,bottom:30,top:10,right:10},selection_is_svg:!1,fillScreen:!1,x_axis_label:"",y_axis_label:"",x_data_label:"1",y_data_label:"2",x_shift:4,data_is_object:!0,color_scale:!1,y_range:!1,title:!1,is_stacked:!1,update_hook:!1,css_path:""}),i=e.setup_svg(r.selection,r.selection_is_svg,r.margins,r.fill_screen);return r.svg=i.svg,r.height=i.height,r.width=i.width,r.ready=e.load_css(r.css_path,function(e){r.css=e,r.ready=!0}),r.layers=[],{update:o,collect_data:u,update_hook:a}}}),n("vis/box-and-whiskers",["./scaffold","lib/d3"],function(e,t){return function(n){function s(){return this}function o(){r.svg.append("style").attr("type","text/css").text(r.css);var n=r.data,i=r.plot_padding,s=r.width,o=r.height,u=[-0.5,n.length-.5],a=[t.min(n,function(e){return e.min}),t.max(n,function(e){return e.max})],f=e.scale_and_axes(u,a,s,o,{padding:i,x_is_log:!1,y_is_log:!1,x_ticks:4,y_ticks:20}),l=f.x,c=f.y;e.add_generic_axis("x","x axis",r.svg,f.x_axis,s,o,i),e.add_generic_axis("y","y axis",r.svg,f.y_axis,s,o,i);var h=t.svg.line().x(function(e){return e[0]}).y(function(e){return e[1]}),p=r.svg.append("g").attr("class","legend").attr("transform","translate(200, 80)").attr("width","300px").attr("height","200px");r.svg.append("g").selectAll("path").data(n).enter().append("path").attr("class","min-max").attr("d",function(e){return h([[l(e.rank),c(e.min)],[l(e.rank),c(e.max)]])}),r.svg.append("g").selectAll("path").data(n).enter().append("path").attr("class","Q1-Q3").attr("d",function(e){return h([[l(e.rank),c(e.Q1)],[l(e.rank),c(e.Q3)]])});var d=0;return r.svg.append("g").selectAll("path").data(n).enter().append("path").attr("class","median").attr("d",function(e){return h([[l(e.rank),c(e.median)-d],[l(e.rank),c(e.median)+d]])}),r.title&&r.svg.append("text").attr("class","title").text(r.title).attr("transform","translate("+r.width/2+",10)").attr("text-anchor","middle"),r.update_hook&&r.update_hook(r.svg),this}function u(e){r.ready||console.warn("Hasn't loaded css yet");if(r.data_is_object){var t=[],n=-1,i=Object.keys(e);while(++n<i.length){var s=e[i[n]];s.rank=n,t.push(s)}r.data=t}else{var n=-1,t=[];while(++n<e.length){var s=e[n];s.rank=n,t.push(s)}r.data=t}return o(),this}function a(e){return r.update_hook=e,this}var r=e.set_options(n,{margins:{top:10,right:10,bottom:10,left:20},plot_padding:{left:30,bottom:30,top:10,right:10},selection_is_svg:!1,fillScreen:!1,x_axis_label:"",y_axis_label:"",data_is_object:!1,y_range:!1,title:!1,update_hook:!1,css:""}),i=e.setup_svg(r.selection,r.selection_is_svg,r.margins,r.fill_screen);return r.svg=i.svg,r.height=i.height,r.width=i.width,r.ready=e.load_css(r.css_path,function(e){r.css=e,r.ready=!0}),r.layers=[],{update:o,collect_data:u,update_hook:a}}}),n("vis/category-legend",["./scaffold","lib/d3"],function(e,t){return function(n){function s(){var e=r.categories;r.selection.select("#legend-container").remove();var t=r.selection.append("g").attr("id","legend-container");t.append("style").attr("type","text/css").text(r.css);var n=t.append("g").attr("transform","translate("+r.margins.left+","+r.margins.top+")"),i=10,s=r.width;return r.squares?n.selectAll("circle").data(r.categories).enter().append("rect").attr("class","legend-circle").attr("width",i*2).attr("height",i*2).attr("transform",function(e,t){return"translate("+(s/2-i)+","+(t*25+20)+")"}).attr("fill",function(e){return r.color_scale(e)}):n.selectAll("circle").data(r.categories).enter().append("circle").attr("class","legend-circle").attr("r",i).attr("cx",s/2-i).attr("cy",function(e,t){return t*25+30}).attr("fill",function(e){return r.color_scale(e)}),n.selectAll("text").data(r.categories).enter().append("text").attr("class","legend-text").attr("text-anchor","end").text(function(e){return e}).attr("x",s/2-3*i).attr("y",function(e,t){return t*25+30+i/2}),this}function o(e,t,n){e==1&&(t.style("height",window.innerHeight-n.bottom+"px"),t.style("width",window.innerWidth-n.right+"px"));var r=parseFloat(t.style("width"))-n.left-n.right,i=parseFloat(t.style("height"))-n.top-n.bottom;return{width:r,height:i}}var r=e.set_options(n,{selection:t.select("body"),selection_is_svg:!1,margins:{top:20,right:20,bottom:30,left:50},fill_screen:!1,categories:[],css_path:"css/category-legend.css",squares:!0}),i=e.setup_svg(r.selection,r.selection_is_svg,r.margins,r.fill_screen);return r.svg=i.svg,r.height=i.height,r.width=i.width,r.ready=e.load_css(r.css_path,function(e){r.css=e,r.ready=!0}),r.layers=[],r.color_scale=t.scale.category20().domain(r.categories),t.text(r.css_path,function(e,t){return e?(console.warn(e),r.css=""):r.css=t,s(),null}),{update:s,get_scale:function(){return r.color_scale}}}}),n("vis/data-menu",["./scaffold","lib/d3"],function(e,t){return function(n){function o(e,t,n,r){t.node().addEventListener("change",function(){u(this.value,r,n)},!1);var i=e[0];a(e,t),u(i,r,n)}function u(t,n,i){e.load_the_file(t,function(e,t){if(e)return console.warn(e);r.data=t,i&&i(t)})}function a(e,t){t.selectAll(".menu-option").data(e).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),t.node().focus()}function f(){return r.data}var r=e.set_options(n,{selection:t.select("body"),getdatafiles:null,datafiles:null,update_callback:null}),i=r.selection.select(".data-menu");i.empty()&&(i=r.selection.append("div").attr("class","data-menu"));var s=i.append("form").append("select").attr("class","dropdown-menu");return r.getdatafiles?(r.datafiles&&console.warn("DataMenu: getdatafiles option overrides datafiles"),t.json(r.getdatafiles,function(e,t){return e?console.warn(e):(o(t.data,s,r.update_callback,r.selection),null)})):r.datafiles?o(r.datafiles,s,r.update_callback,r.selection):console.warn("DataMenu: No datafiles given"),{update:a}}}),n("vis/epistasis",["./scaffold","lib/d3"],function(e,t){return function(n){function s(){return this}function o(){function H(e){e.append("rect").attr("class","square").attr("width",b).attr("height",b).attr("fill",function(e){return e.empty==1?"#fff":w(e.ep)}),e.append("line").attr("class","divider").attr("x1",0).attr("y1",b).attr("x2",b).attr("y2",0)}function B(e){e.append("rect").attr("class","square-outline").attr("width",function(e){return e.empty==1?b:b-Math.floor(E(e.min_max_diff))+1}).attr("height",function(e){return e.empty==1?b:b-Math.floor(E(e.min_max_diff))+1}).attr("transform",function(e){return e.empty==1?"translate(0,0)":"translate("+[Math.floor(E(e.min_max_diff))/2-.5,Math.floor(E(e.min_max_diff))/2-.5]+")"}).style("stroke-width",function(e){return e.empty==1?1:Math.floor(E(e.min_max_diff))})}function j(e){e.attr("transform",function(e){return"translate("+e.index_x*b+","+e.index_y*b+")"})}function F(e){var t=Math.floor(b/4);e.append("g").attr("clip-path","url(#clip-top)").append("circle").attr("class","circle y-circle").attr("r",t).attr("transform",function(e){var n=(e.p_y-50)*t/50>0,r=Math.sqrt(Math.pow((e.p_y-50)*t/50,2)/2);return n&&(r*=-1),"translate("+(b/2+r)+","+(b/2+r)+")"}),e.append("g").attr("clip-path","url(#clip-bottom)").append("circle").attr("class","circle x-circle").attr("r",t).attr("transform",function(e){var n=(e.p_x-50)*t/50>0,r=Math.sqrt(Math.pow((e.p_x-50)*t/50,2)/2);return n&&(r*=-1),"translate("+(b/2-r)+","+(b/2-r)+")"})}var e=r.data.sorted_rxns,n=function(e,t){return{name:"enzyme "+(t+1),index:t}},i=r.data.sorted_names.map(n),s=i,o=r.data.sorted_names.length,u=r.data.cases,a="ep_add",f=[];for(var l=0;l<u.length;l++){var c=u[l],h={},p=e.indexOf(c.rxn1),d=e.indexOf(c.rxn2),v=c.p1,m=c.p2,g=c.min_max_diff;p==-1&&console.warn("no match for "+c.rxn1),d==-1&&console.warn("no match for "+c.rxn2),p<d?(h.index_x=p,h.index_y=d,h.p_x=v,h.p_y=m):(h.index_x=d,h.index_y=p,h.p_x=m,h.p_y=v),h.ep=c[a],h.empty=!1,h.min_max_diff=g,f.push(h)}r.svg.select("#container").remove();var y=r.svg.append("g").attr("id","container").attr("transform","translate("+r.margins.left+","+r.margins.top+")"),b=t.min([Math.floor((r.width-r.padding.left-r.padding.right)/o),Math.floor((r.height-r.padding.top-r.padding.bottom)/o)]),w=t.scale.linear().domain([t.min(f,function(e){return e.ep}),0,t.max(f,function(e){return e.ep})]).range(["#AF8DC3","#F7F7F7","#7FBF7B"]),E=t.scale.linear().domain([t.min(f,function(e){return e.min_max_diff}),t.max(f,function(e){return e.min_max_diff})]).range([1,4]);r.svg.select("defs").remove();var S=r.svg.append("defs");S.append("style").attr("type","text/css").text(r.css),S.append("clipPath").attr("id","clip-top").append("path").attr("d","M 0 0 L 0 "+b+" L "+b+" 0 L 0 0"),S.append("clipPath").attr("id","clip-bottom").append("path").attr("d","M 0 "+b+" L "+b+" 0 L "+b+" "+b+" L 0 "+b);var x={x:r.padding.left,y:r.padding.top};for(var l=0,T=[];l<o;l++)T.push({empty:!0,index_x:l,index_y:l});var N=y.append("g").attr("transform","translate("+r.padding.left+","+r.padding.top+")").selectAll(".cell").data(T);N.enter().append("g").attr("class","cell").call(H),N.call(j);var C=y.append("g").attr("transform","translate("+r.padding.left+","+r.padding.top+")").selectAll(".cell").data(f);C.enter().append("g").attr("class","cell").call(H).call(F),C.call(j);var k=y.append("g").attr("transform","translate("+r.padding.left+","+r.padding.top+")").selectAll(".cell-outline").data(T);k.enter().append("g").attr("class","cell-outline").call(B),k.call(j);var L=y.append("g").attr("transform","translate("+r.padding.left+","+r.padding.top+")").selectAll(".cell-outline").data(f);L.enter().append("g").attr("class","cell-outline").call(B),L.call(j);var A=y.append("g").attr("class","labels").selectAll(".x-label").data(i);A.enter().append("text").attr("class","x-label").text(function(e){return e.name}),A.attr("transform",function(e){return"translate("+(e.index*b+b/3+r.padding.left)+","+(r.height-r.padding.bottom)+") "+"rotate("+45+")"});var O=y.append("g").attr("class","labels").selectAll(".y-label").data(s);O.enter().append("text").attr("class","y-label").attr("text-anchor","end").text(function(e){return e.name}),O.attr("transform",function(e){return"translate("+(r.padding.left-3)+","+(e.index*b+b/2+r.padding.top)+") "+"rotate("+0+")"});var M=y.append("g").attr("class","flux-arrows").attr("transform","translate("+(r.width/2+80)+","+(r.height/2-80)+")rotate(45)");M.append("text").text("High flux").attr("transform","translate("+(-(r.width-r.padding.left-r.padding.right)/2+50)+",0)"),M.append("text").text("Low flux").attr("transform","translate("+((r.width-r.padding.left-r.padding.right)/2-50)+",0)");var _=y.append("g").attr("class","legend").attr("transform","translate("+(r.width-140)+","+230+")"),D=w.range(),P=y.append("defs").append("linearGradient").attr("id","gradient");return P.append("stop").attr("stop-color",D[0]).attr("offset","0%"),P.append("stop").attr("stop-color",D[1]).attr("offset","50%"),P.append("stop").attr("stop-color",D[2]).attr("offset","100%"),_.append("rect").attr("class","legend-gradient").attr("width",150).attr("height",30).attr("fill","url(#gradient)").attr("transform","rotate(-90)").style("stroke","#333").style("stroke-width","2px"),_.append("text").text("positive").attr("transform","translate(40, -140)"),_.append("text").text("negative").attr("transform","translate(40, 0)"),this}function u(e){return r.ready||console.warn("Hasn't loaded css yet"),r.data=e,o(),this}var r=e.set_options(n,{margins:{top:0,right:0,bottom:0,left:0},padding:{left:70,bottom:60,top:10,right:40},selection_is_svg:!1,fillScreen:!1,x_axis_label:"",y_axis_label:"",x_data_label:"1",y_data_label:"2",x_shift:4,data_is_object:!0,color_scale:!1,y_range:!1,title:!1,is_stacked:!1,update_hook:!1,css_path:""}),i=e.setup_svg(r.selection,r.selection_is_svg,r.margins,r.fill_screen);return r.svg=i.svg,r.height=i.height,r.width=i.width,r.ready=e.load_css(r.css_path,function(e){r.css=e,r.ready=!0}),r.layers=[],{update:o,collect_data:u,update_size:s}}}),n("lib/vkbeautify",[],function(){function e(e){var t="    ";if(isNaN(parseInt(e)))t=e;else switch(e){case 1:t=" ";break;case 2:t="  ";break;case 3:t="   ";break;case 4:t="    ";break;case 5:t="     ";break;case 6:t="      ";break;case 7:t="       ";break;case 8:t="        ";break;case 9:t="         ";break;case 10:t="          ";break;case 11:t="           ";break;case 12:t="            "}var n=["\n"];for(ix=0;ix<100;ix++)n.push(n[ix]+t);return n}function t(){this.step="    ",this.shift=e(this.step)}function n(e,t){return t-(e.replace(/\(/g,"").length-e.replace(/\)/g,"").length)}function r(e,t){return e.replace(/\s{1,}/g," ").replace(/ AND /ig,"~::~"+t+t+"AND ").replace(/ BETWEEN /ig,"~::~"+t+"BETWEEN ").replace(/ CASE /ig,"~::~"+t+"CASE ").replace(/ ELSE /ig,"~::~"+t+"ELSE ").replace(/ END /ig,"~::~"+t+"END ").replace(/ FROM /ig,"~::~FROM ").replace(/ GROUP\s{1,}BY/ig,"~::~GROUP BY ").replace(/ HAVING /ig,"~::~HAVING ").replace(/ IN /ig," IN ").replace(/ JOIN /ig,"~::~JOIN ").replace(/ CROSS~::~{1,}JOIN /ig,"~::~CROSS JOIN ").replace(/ INNER~::~{1,}JOIN /ig,"~::~INNER JOIN ").replace(/ LEFT~::~{1,}JOIN /ig,"~::~LEFT JOIN ").replace(/ RIGHT~::~{1,}JOIN /ig,"~::~RIGHT JOIN ").replace(/ ON /ig,"~::~"+t+"ON ").replace(/ OR /ig,"~::~"+t+t+"OR ").replace(/ ORDER\s{1,}BY/ig,"~::~ORDER BY ").replace(/ OVER /ig,"~::~"+t+"OVER ").replace(/\(\s{0,}SELECT /ig,"~::~(SELECT ").replace(/\)\s{0,}SELECT /ig,")~::~SELECT ").replace(/ THEN /ig," THEN~::~"+t+"").replace(/ UNION /ig,"~::~UNION~::~").replace(/ USING /ig,"~::~USING ").replace(/ WHEN /ig,"~::~"+t+"WHEN ").replace(/ WHERE /ig,"~::~WHERE ").replace(/ WITH /ig,"~::~WITH ").replace(/ ALL /ig," ALL ").replace(/ AS /ig," AS ").replace(/ ASC /ig," ASC ").replace(/ DESC /ig," DESC ").replace(/ DISTINCT /ig," DISTINCT ").replace(/ EXISTS /ig," EXISTS ").replace(/ NOT /ig," NOT ").replace(/ NULL /ig," NULL ").replace(/ LIKE /ig," LIKE ").replace(/\s{0,}SELECT /ig,"SELECT ").replace(/\s{0,}UPDATE /ig,"UPDATE ").replace(/ SET /ig," SET ").replace(/~::~{1,}/g,"~::~").split("~::~")}return t.prototype.xml=function(t,n){var r=t.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").replace(/\s*xmlns\=/g,"~::~xmlns=").split("~::~"),i=r.length,s=!1,o=0,u="",a=0,f=n?e(n):this.shift;for(a=0;a<i;a++)if(r[a].search(/<!/)>-1){u+=f[o]+r[a],s=!0;if(r[a].search(/-->/)>-1||r[a].search(/\]>/)>-1||r[a].search(/!DOCTYPE/)>-1)s=!1}else r[a].search(/-->/)>-1||r[a].search(/\]>/)>-1?(u+=r[a],s=!1):/^<\w/.exec(r[a-1])&&/^<\/\w/.exec(r[a])&&/^<[\w:\-\.\,]+/.exec(r[a-1])==/^<\/[\w:\-\.\,]+/.exec(r[a])[0].replace("/","")?(u+=r[a],s||o--):r[a].search(/<\w/)>-1&&r[a].search(/<\//)==-1&&r[a].search(/\/>/)==-1?u=s?u+=r[a]:u+=f[o++]+r[a]:r[a].search(/<\w/)>-1&&r[a].search(/<\//)>-1?u=s?u+=r[a]:u+=f[o]+r[a]:r[a].search(/<\//)>-1?u=s?u+=r[a]:u+=f[--o]+r[a]:r[a].search(/\/>/)>-1?u=s?u+=r[a]:u+=f[o]+r[a]:r[a].search(/<\?/)>-1?u+=f[o]+r[a]:r[a].search(/xmlns\:/)>-1||r[a].search(/xmlns\=/)>-1?u+=f[o]+r[a]:u+=r[a];return u[0]=="\n"?u.slice(1):u},t.prototype.json=function(e,t){var t=t?t:this.step;return typeof JSON=="undefined"?e:typeof e=="string"?JSON.stringify(JSON.parse(e),null,t):typeof e=="object"?JSON.stringify(e,null,t):e},t.prototype.css=function(t,n){var r=t.replace(/\s{1,}/g," ").replace(/\{/g,"{~::~").replace(/\}/g,"~::~}~::~").replace(/\;/g,";~::~").replace(/\/\*/g,"~::~/*").replace(/\*\//g,"*/~::~").replace(/~::~\s{0,}~::~/g,"~::~").split("~::~"),i=r.length,s=0,o="",u=0,a=n?e(n):this.shift;for(u=0;u<i;u++)/\{/.exec(r[u])?o+=a[s++]+r[u]:/\}/.exec(r[u])?o+=a[--s]+r[u]:/\*\\/.exec(r[u])?o+=a[s]+r[u]:o+=a[s]+r[u];return o.replace(/^\n{1,}/,"")},t.prototype.sql=function(t,i){var s=t.replace(/\s{1,}/g," ").replace(/\'/ig,"~::~'").split("~::~"),o=s.length,u=[],a=0,f=this.step,l=!0,c=!1,h=0,p="",d=0,v=i?e(i):this.shift;for(d=0;d<o;d++)d%2?u=u.concat(s[d]):u=u.concat(r(s[d],f));o=u.length;for(d=0;d<o;d++){h=n(u[d],h),/\s{0,}\s{0,}SELECT\s{0,}/.exec(u[d])&&(u[d]=u[d].replace(/\,/g,",\n"+f+f+"")),/\s{0,}\s{0,}SET\s{0,}/.exec(u[d])&&(u[d]=u[d].replace(/\,/g,",\n"+f+f+"")),/\s{0,}\(\s{0,}SELECT\s{0,}/.exec(u[d])?(a++,p+=v[a]+u[d]):/\'/.exec(u[d])?(h<1&&a&&a--,p+=u[d]):(p+=v[a]+u[d],h<1&&a&&a--);var m=0}return p=p.replace(/^\n{1,}/,"").replace(/\n{1,}/g,"\n"),p},t.prototype.xmlmin=function(e,t){var n=t?e:e.replace(/\<![ \r\n\t]*(--([^\-]|[\r\n]|-[^\-])*--[ \r\n\t]*)\>/g,"").replace(/[ \r\n\t]{1,}xmlns/g," xmlns");return n.replace(/>\s{0,}</g,"><")},t.prototype.jsonmin=function(e){return typeof JSON=="undefined"?e:JSON.stringify(JSON.parse(e),null,0)},t.prototype.cssmin=function(e,t){var n=t?e:e.replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\//g,"");return n.replace(/\s{1,}/g," ").replace(/\{\s{1,}/g,"{").replace(/\}\s{1,}/g,"}").replace(/\;\s{1,}/g,";").replace(/\/\*\s{1,}/g,"/*").replace(/\*\/\s{1,}/g,"*/")},t.prototype.sqlmin=function(e){return e.replace(/\s{1,}/g," ").replace(/\s{1,}\(/,"(").replace(/\s{1,}\)/,")")},new t}),n("vis/export-svg",["lib/d3","lib/vkbeautify"],function(e,t){return function(){var n={};return n.utf8_to_b64=function(e){return window.btoa(unescape(encodeURIComponent(e)))},n.download=function(r,i,s){var o=document.createElement("a"),u,a;o.download=r+".svg",u=(new XMLSerializer).serializeToString(e.select(i).node()),s&&(u=t.xml(u)),u='<?xml version="1.0" encoding="utf-8"?>\n                 <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"\n             "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'+u,o.setAttribute("href-lang","image/svg+xml"),o.href="data:image/svg+xml;base64,"+n.utf8_to_b64(u),a=document.createEvent("MouseEvents"),a.initMouseEvent("click",!0,!1,self,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(a)},{download:n.download}}}),n("vis/histogram",["./scaffold","lib/d3"],function(e,t){return function(n){function s(){function w(e,t,n,r){var i=e.append("g").attr("transform","translate(0,"+n*40+")");i.append("text").text(t).attr("transform","translate(30, 14)"),i.append("rect").attr("width",15).attr("height",15).attr("class",r)}r.svg.select("defs").remove(),r.svg.append("defs").append("style").attr("type","text/css").text(r.css),r.svg.select("#scatter-container").remove();var n=r.svg.append("g").attr("id","scatter-container");r.sel=n.attr("transform","translate("+r.margins.left+","+r.margins.top+")");var i=r.layers,s=r.height,o=r.width,u=-1;while(++u<i.length)if(i[u]===undefined)return console.log("waiting for all indices"),this;var a=[t.min(i,function(e){return t.min(e,function(e){return e.x})}),t.max(i,function(e){return t.max(e,function(e){return e.x})})];r.dom={x:a};var f=!1,l=!1,c=e.scale_and_axes(r.dom.x,null,o,s,{padding:r.padding,x_is_log:f,x_ticks:15});r.x=c.x;var h=[],p=t.layout.histogram().value(function(e){return e.x}).bins(r.x.ticks(15));h=i.map(function(e){return p(e)});var d=[0,t.max(h,function(e){return t.max(e,function(e){return e.y})})];r.dom.y=d,c=e.scale_and_axes(r.dom.x,r.dom.y,o,s,{padding:r.padding,x_is_log:f,y_is_log:l,x_ticks:15}),r.x=c.x,r.y=c.y,e.add_generic_axis("x",r.x_axis_label,r.sel,c.x_axis,o,s,r.padding),e.add_generic_axis("y",r.y_axis_label,r.sel,c.y_axis,o,s,r.padding),console.log(r.dom.x,r.dom.y),r.x_size_scale=t.scale.linear().range([0,o]).domain([0,r.dom.x[1]-r.dom.x[0]]),r.xAxis=t.svg.axis().scale(r.x).orient("bottom").ticks(15),r.yAxis=t.svg.axis().scale(r.y).orient("left").ticks(20);var v=r.sel.append("g").attr("class","legend").attr("transform","translate("+(o-300)+", 80)").attr("width","300px").attr("height","200px");r.diff=8,r.hist_dx=h[0][0].dx;var m=r.x_size_scale(r.hist_dx)-r.diff-r.x_shift;console.log(r.y);for(var g=0;g<h.length;g++){var y="hist-bar"+String(g),b=r.sel.selectAll("."+y).data(h[g]).enter().append("g").attr("class","hist-bar "+y).attr("transform",function(e){return"translate("+(r.x(e.x)+r.x_shift*g-m/2)+","+r.y(e.y)+")"});b.append("rect").attr("x",1).attr("width",m).attr("height",function(e){return r.y(r.dom.y[0])-r.y(e.y)})}return this}function o(){}function u(e,t){return r.layers[t]=e.data,s(),this}var r=e.set_options(n,{margins:{top:10,right:10,bottom:10,left:20},padding:{left:30,bottom:30,top:10,right:10},selection:t.select("body").append("div"),selection_is_svg:!1,fill_screen:!1,title:!1,update_hook:!1,css_path:"",x_axis_label:"",y_axis_label:"",x_data_label:"1",y_data_label:"2",x_shift:10}),i=e.setup_svg(r.selection,r.selection_is_svg,r.margins,r.fill_screen);return r.svg=i.svg,r.height=i.height,r.width=i.width,r.ready=e.load_css(r.css_path,function(e){r.css=e,r.ready=!0}),r.layers=[],{update:s,collect_data:u}}}),n("vis/resize",[],function(){function e(e,t){typeof t=="undefined"&&(t=1e3),window.do_resize=!1,window.onresize=function(e){window.do_resize=!0},window.setInterval(function(){window.do_resize&&(e(),window.do_resize=!1)},t)}return{on_resize:e}}),n("vis/scatter",["./scaffold","lib/d3"],function(e,t){return function(n){function s(){var t=e.resize_svg(r.selection,r.selection_is_svg,r.margins,r.fill_screen);return r.height=t.height,r.width=t.width,t=e.scale_and_axes(r.dom.x,r.dom.y,r.width,r.height,{padding:r.padding,x_is_log:r.x_is_log,y_is_log:r.y_is_log}),r.x=t.x,r.y=t.y,r.x_axis=t.x_axis,r.y_axis=t.y_axis,r.sel.select(".x.axis").remove(),r.sel.select(".y.axis").remove(),e.add_generic_axis("x",r.x_axis_label,r.sel,r.x_axis,r.width,r.height,r.padding),e.add_generic_axis("y",r.y_axis_label,r.sel,r.y_axis,r.width,r.height,r.padding),r.sel.select(".points").selectAll("path").attr("transform",function(e){return"translate("+r.x(e.f1)+","+r.y(e.f2)+")"}),r.sel.select(".trendline").select("path").attr("d",r.line([[r.x(r.dom.x[0]),r.y(r.dom.y[0])],[r.x(r.dom.x[1]),r.y(r.dom.y[1])]])),this}function o(){r.svg.select("defs").remove(),r.svg.append("defs").append("style").attr("type","text/css").text(r.css),r.svg.select("#scatter-container").remove();var n=r.svg.append("g").attr("id","scatter-container");r.sel=n.attr("transform","translate("+r.margins.left+","+r.margins.top+")");var i=r.height,s=r.width,o=r.padding;if(r.layers.length==0)return null;var u=r.layers[0];if(u.x===undefined||u.y===undefined)return console.log("data hasn't finished loading"),null;var a,f,l=[],c=[];for(var h=0;h<u.x.length;h++){a=u.x[h].name;for(var p=0;p<u.y.length;p++)f=u.y[p].name,a==f&&c.indexOf(a)==-1&&(l.push({name:a,f1:u.x[h].x,f2:u.y[p].x}),c.push(a))}var d=l.map(function(e){return e.f1>0?e.f1:null}),v=l.map(function(e){return e.f2>0?e.f2:null}),m=!1;if(m){var g=[t.min([t.min(d),t.min(v)])/2,t.max([t.max(d),t.max(v)])];r.dom={x:g,y:g}}else r.dom={x:[t.min(d)/2,t.max(d)],y:[t.min(v)/2,t.max(v)]};l=l.map(function(e){return e.f1<r.dom.x[0]&&(e.f1=r.dom.x[0]),e.f2<r.dom.y[0]&&(e.f2=r.dom.y[0]),e});var y=e.scale_and_axes(r.dom.x,r.dom.y,s,i,{padding:o,x_is_log:r.x_is_log,y_is_log:r.y_is_log});r.x=y.x,r.y=y.y,r.x_axis=y.x_axis,r.y_axis=y.y_axis,e.add_generic_axis("x",r.x_axis_label,r.sel,y.x_axis,s,i,o),e.add_generic_axis("y",r.y_axis_label,r.sel,y.y_axis,s,i,o),r.line=t.svg.line().x(function(e){return e[0]}).y(function(e){return e[1]});var b=r.sel.append("g").attr("class","legend").attr("transform","translate(200, 80)").attr("width","300px").attr("height","200px");r.sel.append("g").attr("class","points").selectAll("path").data(l).enter().append("path").attr("d",t.svg.symbol().type("circle").size(28)).attr("class","point-circle").style("fill",function(e){return/.*/g.exec(e.name)?"red":"none"}).attr("transform",function(e){return"translate("+r.x(e.f1)+","+r.y(e.f2)+")"}).append("title").text(function(e){return e.name}),r.sel.append("g").attr("class","trendline").append("path").attr("d",r.line([[r.x(r.dom.x[0]),r.y(r.dom.y[0])],[r.x(r.dom.x[1]),r.y(r.dom.y[1])]]));var w=83;return r.tooltip&&r.tooltip.cursor_tooltip(r.sel,s+r.margins.left+r.margins.right,i+r.margins.top+r.margins.bottom,r.x,r.y,w),this}function u(e,t,n){return t!="x"&&t!="y"&&console.warn("bad axis: "+t),r.layers[n]||(r.layers[n]={}),r.layers[n][t]=e,o(),this}var r=e.set_options(n,{margins:{top:10,right:10,bottom:10,left:20},padding:{left:30,bottom:30,top:10,right:10},selection_is_svg:!1,selection:t.select("body"),fillScreen:!1,title:!1,update_hook:!1,css_path:"",tooltip:!1,x_is_log:!0,y_is_log:!0}),i=e.setup_svg(r.selection,r.selection_is_svg,r.margins,r.fill_screen);return r.svg=i.svg,r.height=i.height,r.width=i.width,r.ready=e.load_css(r.css_path,function(e){r.css=e,r.ready=!0}),r.layers=[],{update:o,update_size:s,collect_data:u}}}),n("vis/subplot",["./scaffold","lib/d3"],function(e,t){return function(n){function l(){return r.frames}function c(e,t){return r.frames[e][t]}function h(){var e=r.height/r.rows,n=r.width/r.columns;return t.selectAll(".grid").attr("transform",function(t){return"translate("+Math.floor(t.x_i*n)+","+Math.floor(t.y_i*e)+")"}).attr("width",function(e){return Math.floor(n-r.spacing)}).attr("height",function(t){return Math.floor(e-r.spacing)}),this}var r=e.set_options(n,{margins:{top:0,bottom:0,left:0,right:0},spacing:0,rows:2,columns:2,fill_screen:!1,selection:t.select("body")}),i=e.setup_svg(r.selection,r.selection_is_svg,r.margins,r.fill_screen);r.svg=i.svg,r.height=i.height,r.width=i.width,r.svg.select("#subplot-container").remove();var s=r.svg.append("g").attr("id","subplot-container");r.sel=s.attr("transform","translate("+r.margins.left+","+r.margins.top+")"),r.frames=[];for(var o=0;o<r.rows;o+=1){var u=[];for(var a=0;a<r.columns;a+=1){var f=r.sel.append("g").attr("class","grid").datum({x_i:a,y_i:o});u.push(f)}r.frames.push(u)}return h(),{get_frames:l,frame_by_row_col:c,update:h}}}),n("vis/tooltip",["./scaffold","lib/d3"],function(e,t){return function(n){function i(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}function s(e,t){var n=t.split("\n");e.text("");for(var i=0;i<n.length;i++){var s=e.append("tspan").text(n[i]);i>0&&s.attr("x",0).attr("dy",r.text_height)}return n.length}function o(e,n){var o=t.selectAll(".point-circle").filter(function(e,t){var r=i(n[0],n[1],window.x_scale(e.f1),window.y_scale(e.f2));return r<window.radius});if(o[0].length>0){var u="";o.each(function(e){u+=e.name+"\n"});var a=s(e,u.trim());e.attr("dy",-a*r.text_height/2)}else e.text(""),e.attr("dy","0")}function u(e,n,r,i,s,u){function m(e){v.selectAll(".saved_tooltip").data(e).enter().append("g").attr("class","saved_tooltip").attr("transform",function(e){return"translate("+e[0]+","+e[1]+")"}).call(a)}var f=e.append("rect").attr("width",n).attr("height",r).attr("style","visibility: hidden").attr("pointer-events","all");window.x_scale=i,window.y_scale=s,window.radius=10;var l=e.append("g").attr("class","cursor-tooltip").attr("pointer-events","none"),c=l.append("circle").attr("class","cursor-tooltip-circle").attr("r",window.radius),h=l.append("g").attr("transform","translate("+(window.radius+2)+",0)").append("text").attr("class","cursor-tooltip-text"),p=!1;window.setInterval(function(){p=!0},100),f.on("mousemove",function(e,n){window.loc=t.mouse(this),p&&(l.attr("transform","translate("+loc[0]+","+loc[1]+")"),o(h,loc),p=!1)});var d=[],v=e.append("g").attr("id","saved_tooltips");u>=0&&t.select(window).on("keydown",function(){t.event.keyCode==u&&(d=d.concat([window.loc]),m(d))})}function a(){this.append("circle").attr("class","cursor-tooltip-circle").attr("r",window.radius);var e=this.append("g").attr("transform","translate("+(window.radius+2)+",0)").append("text").attr("class","cursor-tooltip-text");o(e,this.datum())}var r=e.set_options(n,{text_height:18});return{cursor_tooltip:u}}}),n("metabolic-map/utils",["lib/d3"],function(e){function t(t,n,r,i,s){s===undefined&&(s=function(){}),t.select("#container").remove();var o=t.append("g").attr("id","container"),u=o.append("g"),a=function(){u.attr("transform","translate("+e.event.translate+")scale("+e.event.scale+")"),s(e.event)},f=e.behavior.zoom().scaleExtent(i).on("zoom",a);return o.call(f),{sel:u,zoom:f}}function n(e,t){e.select("defs").remove();var n=e.append("defs");return n.append("style").attr("type","text/css").text(t),n}return{setup_zoom_container:t,setup_defs:n}}),n("metabolic-map/main",["vis/scaffold","metabolic-map/utils","lib/d3"],function(e,t,n){return function(r){function u(e,t){e&&console.warn(e),i.css=t}function a(e,t){e&&console.warn(e),i.map_data=t}function f(e,t,n){e&&console.warn("Flux"+n+": "+e),n==0?i.flux=t:n==1&&(i.flux2=t)}function l(e){return i.flux_source=e,this}function c(){return i.flux_source(function(e,t,r){t?r&&m("objective: "+n.format(".3f")(r)+"    (HINT: Click a reaction)"):(m("cell is dead :'("),e=[]),i.map_data=b(i.map_data,e,null,null),i.has_metabolites=!1,i.has_metabolite_deviation=!1,y()}),this}function h(e,t){return delete i.listeners[e][t],p(e,t,null),this}function p(e,t,r,i){var s=r;r!=null&&(s=function(e){r.call(i,e.id)}),n.selectAll(e).on(t,s)}function d(){for(var e in i.listeners)for(var t in i.listeners[e])p(e,t,i.listeners[e][t].callback,i.listeners[e][t].context)}function v(e,t,n){return i.listeners.hasOwnProperty(e)||(i.listeners[e]={}),i.listeners[e][t]={callback:n,context:this},p(e,t,n,this),this}function m(e){var t=n.select("body").select("#status");return t.empty()&&(t=n.select("body").append("text").attr("id","status")),t.text(e),this}function g(){function s(e){return[]}function o(e,t,r,i){var s=Math.min(r/e,i/t),o={};return o.x=n.scale.linear().domain([0,e]).range([(r-e*s)/2,e*s+(r-e*s)/2]),o.y=n.scale.linear().domain([0,t]).range([(i-t*s)/2,t*s+(i-t*s)/2]),o.x_size=n.scale.linear().domain([0,e]).range([0,e*s]),o.y_size=n.scale.linear().domain([0,t]).range([0,t*s]),o.size=n.scale.linear().domain([0,1]).range([0,s]),o.flux=n.scale.linear().domain([0,40]).range([6,6]),o.flux_fill=n.scale.linear().domain([0,40,200]).range([1,1,1]),o.flux_color=n.scale.linear().domain([0,1,20,50]).range(["rgb(200,200,200)","rgb(150,150,255)","blue","red"]),o.metabolite_concentration=n.scale.linear().domain([0,10]).range([15,200]),o.metabolite_color=n.scale.linear().domain([0,1.2]).range(["#FEF0D9","#B30000"]),o.scale_path=function(e){var t=o.x,r=o.y,i=n.format(".2f"),e=e.replace(/(M|L)([0-9-.]+),?\s*([0-9-.]+)/g,function(e,n,s,o){return n+[i(t(parseFloat(s))),i(r(parseFloat(o)))].join(", ")}),s=/C([0-9-.]+),?\s*([0-9-.]+)\s*([0-9-.]+),?\s*([0-9-.]+)\s*([0-9-.]+),?\s*([0-9-.]+)/g;return e=e.replace(s,function(e,n,s,o,u,a,f){return"C"+i(t(parseFloat(n)))+","+i(r(parseFloat(s)))+" "+i(t(parseFloat(o)))+","+i(r(parseFloat(u)))+" "+[i(t(parseFloat(a)))+","+i(r(parseFloat(f)))]}),e},o.scale_decimals=function(e,t,r){var i=n.format("."+String(r)+"f");return e=e.replace(/([0-9.]+)/g,function(e,n){return i(t(parseFloat(n)))}),e},o}function u(e){var t=e.append("g").attr("id","markers");return t.append("marker").attr("id","end-triangle-path-color").attr("markerHeight",2.1).attr("markerUnits","strokeWidth").attr("markerWidth",2.1).attr("orient","auto").attr("refX",0).attr("refY",6).attr("viewBox","0 0 12 12").append("path").attr("d","M 0 0 L 12 6 L 0 12 z").attr("class","marker"),t.append("marker").attr("id","start-triangle-path-color").attr("markerHeight",2).attr("markerUnits","strokeWidth").attr("markerWidth",2).attr("orient","auto").attr("refX",12).attr("refY",6).attr("viewBox","0 0 12 12").append("path").attr("d","M 12 0 L 0 6 L 12 12 z").attr("class","marker"),e}i.decimal_format=n.format(".1f"),i.decimal_format_3=n.format(".3f"),i.style_variables=s(i.style),i.scale=o(i.map_data.max_map_w,i.map_data.max_map_h,i.width,i.height);var e=t.setup_defs(i.svg,i.css);u(e);var r=t.setup_zoom_container(i.svg,i.width,i.height,[1,15]);i.sel=r.sel,i.has_flux=!1,i.has_flux_comparison=!1,i.has_metabolites=!1,i.has_metabolite_deviation=!1,i.flux&&(i.has_flux=!0,i.map_data=w(i.map_data,i.flux),i.flux2&&(i.has_flux_comparison=!0,i.map_data=E(i.map_data,i.flux2))),i.metabolites&&(i.has_metabolites=!0,i.map_data=S(i.map_data,i.metabolites),i.metabolites2&&(i.has_metabolite_deviation=!0,i.map_data=x(i.map_data,i.metabolites2))),c(),y()}function y(e){function m(e,t,n){e.append("g").attr("id","membranes").selectAll("rect").data(t).enter().append("rect").attr("class",function(e){return e.class}).attr("width",function(e){return n.x_size(e.width)}).attr("height",function(e){return n.y_size(e.height)}).attr("transform",function(e){return"translate("+n.x(e.x)+","+n.y(e.y)+")"}).style("stroke-width",function(e){return n.size(10)}).attr("rx",function(e){return n.x_size(20)}).attr("ry",function(e){return n.x_size(20)})}function g(e,t,i,s,o){function u(e,t){var r=t.filter(function(e){return e.hasOwnProperty("metabolite_deviation")&&e.hasOwnProperty("metabolite_concentration")}),s=n.svg.arc().startAngle(function(e){return-e.metabolite_deviation/100/2*2*Math.PI}).endAngle(function(e){return e.metabolite_deviation/100/2*2*Math.PI}).innerRadius(function(e){return 0}).outerRadius(function(e){var t;return e.should_size?t=i.size(i.metabolite_concentration(e.metabolite_concentration)):t=i.size(0),t});e.append("g").attr("id","metabolite-deviation-arcs").selectAll("path").data(r).enter().append("path").attr("d",s).attr("style","fill:black;stroke:none;opacity:0.4;").attr("transform",function(e){return"translate("+i.x(e.cx)+","+i.y(e.cy)+")"})}e.append("g").attr("id","metabolite-circles").selectAll("circle").data(r.metabolite_circles).enter().append("circle").attr("r",function(e){var t=i.metabolite_concentration;if(e.metabolite_concentration){var n;return e.should_size?n=i.size(t(e.metabolite_concentration)):n=i.size(0),n}return s?i.size(10):i.size(e.r)}).attr("style",function(e){var t=i.metabolite_color;if(e.metabolite_concentration){var n;return e.should_color?n="fill:"+t(e.metabolite_concentration)+";"+"stroke:black;stroke-width:0.5;":n="fill:none;stroke:black;stroke-width:0.5;",n}return s?"fill:grey;stroke:none;stroke-width:0.5;":""}).attr("transform",function(e){return"translate("+i.x(e.cx)+","+i.y(e.cy)+")"}),o&&u(e,t)}function y(e,t,n){e.append("g").attr("id","metabolite-paths").selectAll("path").data(t).enter().append("path").attr("d",function(e){return n.scale_path(e.d)}).style("fill","rgb(224, 134, 91)").style("stroke","rgb(162, 69, 16)").style("stroke-width",String(n.size(2))+"px")}function b(e,t,n,r,i,s){e.append("g").attr("id","reaction-labels").selectAll("text").data(t).enter().append("text").attr("class","reaction-label").text(function(e){var t=e.text;return i?t+=" ("+l(e.flux1)+"/"+l(e.flux2)+": "+l(e.flux)+")":e.flux?t+=" ("+l(e.flux)+")":r&&(t+=" (0)"),t}).attr("text-anchor","start").attr("font-size",function(e){var t;return s.hasOwnProperty("reaction_label_size")?t=s.reaction_label_size:t=15,n.size(t)}).attr("transform",function(e){return"translate("+n.x(e.x)+","+n.y(e.y)+")"})}function w(e,t,n,r){e.append("g").attr("id",t).selectAll("text").data(n).enter().append("text").text(function(e){return e.text}).attr("font-size",r.size(60)).attr("transform",function(e){return"translate("+r.x(e.x)+","+r.y(e.y)+")"})}function E(e,t,n,r,i,s){e.append("g").attr("id","metabolite-labels").selectAll("text").data(t).enter().append("text").text(function(e){var t=e.text;if(!isNaN(e.metabolite_concentration))if(i){var n=isNaN(e.metabolite_concentration)?"-":s(e.metabolite_concentration),o=isNaN(e.metabolite_deviation)?"-":s(e.metabolite_deviation);t+=" ("+n+" Â± "+o+"%)"}else if(e.metabolite_concentration){var n=isNaN(e.metabolite_concentration)?"-":s(e.metabolite_concentration);t+=" ("+n+")"}else r&&(t+=" (0)");return t}).attr("font-size",function(e){return e.metabolite_concentration?n.size(30):r?n.size(20):n.size(20)}).style("visibility","visible").attr("transform",function(e){return"translate("+n.x(e.x)+","+n.y(e.y)+")"})}function S(e,t,n,r){e.append("g").attr("id","reaction-paths").selectAll("path").data(t).enter().append("path").attr("d",function(e){return n.scale_path(e.d)}).attr("class",function(e){return e["class"]+" reaction-path"}).attr("style",function(e){var t="",i=n.flux;return e["class"]=="fill-arrow"&&(i=n.flux_fill),e.flux?(t+="stroke-width:"+String(n.size(i(Math.abs(e.flux))))+";",t+="stroke:"+n.flux_color(Math.abs(e.flux))+";",e["class"]=="fill-arrow"?t+="fill:"+n.flux_color(Math.abs(e.flux))+";":e["class"]=="line-arrow"?x():t+="fill:none"):r?(t+="stroke-width:"+String(n.size(i(0)))+";",t+="stroke:"+n.flux_color(Math.abs(0))+";",e["class"]=="fill-arrow"?t+="fill:"+n.flux_color(0)+";":t+="fill:none"):t+="stroke-width:"+String(n.size(1))+";",t}).style("marker-end",function(e){return/end/.test(e.class)?e.flux?x(n.flux_color(e.flux)):r?x(n.flux_color(0)):"url(#end-triangle-path-color)":""}).style("marker-start",function(e){return/start/.test(e.class)?e.flux?x(n.flux_color(e.flux)):r?x(n.flux_color(0)):"url(#start-triangle-path-color)":""})}function x(e){return n.select("#markers").selectAll("marker"),""}e===undefined&&(e=function(){});var t=i.sel,r=i.map_data,s=i.css,o=i.style_variables,u=i.scale,a=i.width,f=i.height,l=i.decimal_format,c=i.has_metabolites,h=i.has_metabolite_deviation,p=i.has_flux,v=i.has_flux_comparison;t.selectAll("*").remove(),t.append("rect").attr("class","overlay").attr("width",a).attr("height",f).attr("style","stroke:black;fill:none;"),m(t,r.membrane_rectangles,u),r.hasOwnProperty("metabolite_circles")?g(t,r.metabolite_circles,u,c,h):r.hasOwnProperty("metabolite_paths")&&(c&&alert("metabolites do not render w simpheny maps"),y(t,r.metabolite_paths,u)),b(t,r.reaction_labels,u,p,v,o),w(t,"misc-labels",r.misc_labels,u),E(t,r.metabolite_labels,u,c,h,l),S(t,r.reaction_paths,u,p),d()}function b(e,t,n,r){i.has_flux=!1,i.has_flux_comparison=!1,i.has_metabolites=!1,i.has_metabolite_deviation=!1;var s=function(e){return e.reaction_paths.map(function(e){return delete e.flux,e}),e.reaction_labels.map(function(e){return delete e.flux,e}),e};if(t.length>0){var o=t[0];i.has_flux=!0,e=w(e,o);if(t.length>1){var u=t[1];i.has_flux_comparison=!0,e=E(e,u)}}else s(e);return n&&(i.has_metabolites=!0,e=S(e,n),r&&(i.has_metabolite_deviation=!0,e=x(e,r))),e}function w(e,t){return e.reaction_paths=e.reaction_paths.map(function(e){return e.id in t&&(e.flux=parseFloat(t[e.id])),e}),e.reaction_labels=e.reaction_labels.map(function(e){return e.text in t&&(e.flux=parseFloat(t[e.text])),e}),e}function E(e,t){return e.reaction_paths=e.reaction_paths.map(function(e){return e.id in t&&e.flux&&(e.flux=parseFloat(t[e.id])-e.flux),e}),e.reaction_labels=e.reaction_labels.map(function(e){return e.flux?e.flux1=e.flux:e.flux1=0,e.text in t?e.flux2=parseFloat(t[e.text]):e.flux2=0,e.flux=e.flux2-e.flux1,e}),e}function S(e,t){var n=[],r=["nad","nadp","nadh","nadph","atp","adp","coa","accoa"];return e.metabolite_circles=e.metabolite_circles.map(function(e){return e.id in t&&n.indexOf(e.id)==-1&&(e.metabolite_concentration=parseFloat(t[e.id]),r.indexOf(e.id)>=0?(e.should_size=!1,e.should_color=!0):(e.should_size=!0,e.should_color=!1)),e}),e.metabolite_labels=e.metabolite_labels.map(function(e){return e.text in t&&(e.metabolite_concentration=parseFloat(t[e.text])),e}),e}function x(e,t){return e.metabolite_circles=e.metabolite_circles.map(function(e){return e.id in t&&(e.metabolite_deviation=parseFloat(t[e.id])),e}),e.metabolite_labels=e.metabolite_labels.map(function(e){return e.text in t&&(e.metabolite_deviation=parseFloat(t[e.text])),e}),e}var i=e.set_options(r,{margins:{top:10,right:10,bottom:10,left:20},selection_is_svg:!1,fillScreen:!1,update_hook:!1,css_path:"css/metabolic-map.css",map_path:null,map_json:null,flux_path:null,flux:null,flux2_path:null,flux2:null,flux_source:function(){},css:""}),s=e.setup_svg(i.selection,i.selection_is_svg,i.margins,i.fill_screen);i.svg=s.svg,i.height=s.height,i.width=s.width,i.listeners={};var o=[{file:i.map_path,callback:a,value:i.map_json},{file:i.css_path,callback:u,value:i.css},{file:i.flux_path,callback:function(e,t){f(e,t,0)},value:i.flux},{file:i.flux2_path,callback:function(e,t){f(e,t,1)},value:i.flux2}];return!i.map_json&&!i.map_path?console.warn("No map provided. Set either map_json or map_path"):(e.load_files(o,g),{set_flux_source:l,add_listener:v,remove_listener:h,reload_flux:c,set_status:m})}}),n("metabolic-map/knockout",["vis/scaffold","lib/d3"],function(e,t){return function(n){function i(e){r.reactions[e]=!0}function s(e){var n="/knockout-map/",i=-1,s="?",u=Object.keys(r.reactions);while(++i<u.length)i>0&&(s="&"),n+=s+"reactions[]="+encodeURIComponent(u[i]),console.log(n);t.json(n,function(t,n){if(t)return console.warn(t);var i=n.x,s=n.f;return r.latest_flux=i,r.latest_objective_value=s,e([i],s>1e-7,s),null})}var r=e.set_options(n,{});return r.reactions={},r.latest_flux=[],r.latest_objective_value=[],{add_reaction:i,get_flux:s}}}),n("lib/jquery",[],function(){return window.$===undefined&&console.warn("jquery is not loaded."),window.$}),n("lib/builder/jquery-ui",[],function(){return window.$===undefined?console.warn("jquery is still not loaded."):window.$.ui===undefined?console.warn("jquery-ui is not loaded."):window.$.ui}),n("builder/main",["vis/scaffold","metabolic-map/utils","lib/d3","lib/jquery","lib/builder/jquery-ui"],function(e,t,n){return function(r){function u(e,t){e&&console.warn(e),i.css=t}function a(e,t){e&&console.warn(e),i.map_data=t}function f(e,t,n){e&&console.warn(e),n==0?i.flux=t:n==1&&(i.flux2=t)}function l(e){return e.append("input").attr("id","rxn-input").style("display","none")}function c(){i.version=.2,i.selected_node={reaction_id:"",metabolite_id:"",direction:"",is_selected:!1},i.drawn_reactions={},i.arrowheads_generated=[],i.cobra_reactions={},i.list_strings=[],i.scale={},i.scale.flux_color=n.scale.linear().domain([0,20]).range(["blue","red"]),i.default_reaction_color="#eeeeee",i.decimal_format=n.format(".1f"),i.window_translate={x:0,y:0},i.window_scale=1,i.map_data={},i.mode="builder";var e=i.svg,r=i.css,s=i.width,o=i.height,u=t.setup_defs(e,r),a=t.setup_zoom_container(e,s,o,[.05,15],function(e){i.window_translate={x:e.translate[0],y:e.translate[1]},i.window_scale=e.scale,p(S())}),f=a.sel,l=a.zoom;i.zoom=l,i.sel=f,i.sel.append("g").attr("id","reactions");var c={x:i.width/2,y:40};h(c,function(){w("GLCtex",c),n.select("#loading").style("display","none"),window.setTimeout(function(){$("#rxn-input").focus()},50)}),I()}function h(e,t){n.json("data/maps/cobra_model_0.2.json",function(r,s){r&&console.warn(r),i.cobra_reactions=s.reactions,n.json("data/flux/flux-wt-pFBA.json",function(n,r){n&&console.warn(n);var s=[];for(var o in r)s.push([o.replace("(","_").replace(")",""),parseFloat(r[o])]);s.sort(function(e,t){return Math.abs(t[1])-Math.abs(e[1])});var u=-1;while(++u<s.length){i.list_strings.push({label:s[u][0]+" -- "+s[u][1],value:s[u][0]});for(var a in i.cobra_reactions)if(a==s[u][0]){i.cobra_reactions[a].flux=s[u][1];for(var f in i.cobra_reactions[a].metabolites)i.cobra_reactions[a].metabolites[f].flux=s[u][1]}}d(e),t()})})}function p(e){var t={x:280,y:0},r=n.select("#rxn-input"),s=Math.max(20,Math.min(i.width-270,i.window_scale*e.x+i.window_translate.x-t.x)),o=Math.max(20,Math.min(i.height-40,i.window_scale*e.y+i.window_translate.y-t.y));r.node().blur(),r.style("position","absolute").attr("placeholder","Reaction ID -- Flux").style("display","block").style("left",s+"px").style("top",o+"px").on("input",function(){this.value=this.value.replace(" ","")})}function d(e){p(e);var t=[],n=function(e){for(var t in i.drawn_reactions)if(e==t)return!0;return!1};for(var r in i.cobra_reactions){var s=i.cobra_reactions[r];if(n(r))continue;if(i.selected_node.is_selected)for(var o in s.metabolites)o==i.selected_node.metabolite_id&&s.metabolites[o].coefficient<0&&t.push(r);else t.push(r)}var u=20;$("#rxn-input").autocomplete({autoFocus:!0,minLength:0,source:function(e,n){var r=$.ui.autocomplete.escapeRegex(e.term),s=new RegExp("^"+r,"i"),o=i.list_strings.filter(function(e){return t.indexOf(e.value)>=0?s.test(e.value):!1});n(o.slice(0,u))},change:function(t,n){n.item&&(w(n.item.value,e),this.value="")}})}function v(e){return e}function m(e,t,n){var r=-1,i=[];while(++r<e.length)i.push(g(e[r]));return i}function g(e,t,n){var r=Math.cos(t)*(e.x-n.x)+Math.sin(t)*(e.y-n.y)+n.x,i=-Math.sin(t)*(e.x-n.x)+Math.cos(t)*(e.y-n.y)+n.y;return{x:r,y:i}}function y(e){var t=120;e.dis=t;var n=[{x:0,y:0},{x:0,y:t}];return e.main_axis=n,e.center={x:(n[0].x+n[1].x)/2,y:(n[0].y+n[1].y)/2},e}function b(e,t,n,r,i,s){e.text_dis={x:0,y:-18};var o=60,u=.5,a=.2,f=o*.7,l=20,c=Math.min(2,e.count-1),h,p;e.is_primary?(e.r=10,h=20):(e.r=5,h=10,e.index>t?p=e.index-1:p=e.index);var d=s-h,v=[{x:0,y:h},{x:0,y:d}],m=i,y,b,w,E;return e.coefficient<0&&e.is_primary?(y={x:v[0].x+e.dis.x,y:v[0].y+e.dis.y},w={x:m.x*u+v[0].x*(1-u),y:m.y*u+v[0].y*(1-u)},E={x:m.x*a+y.x*(1-a),y:m.y*a+y.y*(1-a)},b={x:r[0].x+e.dis.x,y:r[0].y+e.dis.y}):e.coefficient<0?(y={x:v[0].x+(f*p-f*(c-1)/2)+e.dis.x,y:v[0].y+l+e.dis.y},w={x:m.x*u+v[0].x*(1-u),y:m.y*u+v[0].y*(1-u)},E={x:m.x*a+y.x*(1-a),y:m.y*a+y.y*(1-a)},b={x:r[0].x+(o*p-o*(c-1)/2)+e.dis.x,y:r[0].y+l+e.dis.y}):e.coefficient>0&&e.is_primary?(y={x:v[1].x+e.dis.x,y:v[1].y+e.dis.y},w={x:m.x*u+v[1].x*(1-u),y:m.y*u+v[1].y*(1-u)},E={x:m.x*a+y.x*(1-a),y:m.y*a+y.y*(1-a)},b={x:r[1].x+e.dis.x,y:r[1].y+e.dis.y}):e.coefficient>0&&(y={x:v[1].x+(f*p-f*(c-1)/2)+e.dis.x,y:v[1].y-l+e.dis.y},w={x:m.x*u+v[1].x*(1-u),y:m.y*u+v[1].y*(1-u)},E={x:m.x*a+y.x*(1-a),y:m.y*a+y.y*(1-a)},b={x:r[1].x+(o*p-o*(c-1)/2)+e.dis.x,y:r[1].y-l+e.dis.y}),e.start=g(m,n,r[0]),e.end=g(y,n,r[0]),e.b1=g(w,n,r[0]),e.b2=g(E,n,r[0]),e.circle=g(b,n,r[0]),e}function w(e,t){if(i.drawn_reactions.hasOwnProperty(e)){console.warn("reaction is already drawn");return}var n=$.extend(!0,{},i.cobra_reactions[e]);n.coords=v(t),n.angle=0*(Math.PI/180),n=y(n);var r=0,s=0,o=0,u=0,a="";for(var f in n.metabolites){var l=n.metabolites[f];l.coefficient<0?(l.index=o,o==r&&(l.is_primary=!0),o++):(l.index=u,u==s&&(l.is_primary=!0,a=f),u++)}for(f in n.metabolites){l=n.metabolites[f];var c;l.coefficient<0?(l.count=o+1,c=r):(l.count=u+1,c=s),l.reaction_id=e,l.dis={x:0,y:0},l=b(l,c,n.angle,n.main_axis,n.center,n.dis)}i.drawn_reactions[e]=n,i.selected_node={reaction_id:e,direction:"product",metabolite_id:a,is_selected:!0},P();var h=S();E(h),d(h),setTimeout(function(){$("#rxn-input").focus()},50)}function E(e){var t=200,n,r={x:{min:-i.window_translate.x,max:(i.width-i.window_translate.x)/i.window_scale},y:{min:-i.window_translate.y,max:(i.height-i.window_translate.y)/i.window_scale}},s=function(){i.zoom.translate([i.window_translate.x,i.window_translate.y]),i.zoom.scale(i.window_scale),i.sel.transition().attr("transform","translate("+i.window_translate.x+","+i.window_translate.y+")scale("+i.window_scale+")")};e.x<r.x.min+t?(n=-(e.x-r.x.min-t)*i.window_scale+i.window_translate.x,i.window_translate.x=n,s()):e.x>r.x.max-t&&(n=-(e.x-r.x.max+t)*i.window_scale+i.window_translate.x,i.window_translate.x=n,s()),e.y<r.y.min+t?(n=-(e.y-r.y.min-t)*i.window_scale+i.window_translate.y,i.window_translate.y=n,s()):e.y>r.y.max-t&&(n=-(e.y-r.y.max+t)*i.window_scale+i.window_translate.y,i.window_translate.y=n,s())}function S(){return i.selected_node.is_selected?x(i.selected_node.metabolite_id,i.selected_node.reaction_id):(console.log("no node selected"),{x:0,y:0})}function x(e,t){var n=i.drawn_reactions[t],r=n.metabolites[e],s=n.coords;return{x:s.x+r.circle.x,y:s.y+r.circle.y}}function T(){if(!i.selected_node.is_selected){console.log("no selected node");return}var e,t,n=i.drawn_reactions[i.selected_node.reaction_id];for(var r in n.metabolites){var s=n.metabolites[r];(s.coefficient>0&&i.selected_node.direction=="product"||s.coefficient<0&&i.selected_node.direction=="reactant")&&s.is_primary&&(e=s.index,t=s.count)}var o=e+1<t-1?e+1:0;N(o)}function N(e){if(!i.selected_node.is_selected){console.log("no selected node");return}var t,n=i.drawn_reactions[i.selected_node.reaction_id],r=n.metabolites[i.selected_node.metabolite_id].is_primary,s=r?!0:!1;for(var o in n.metabolites){var u=n.metabolites[o];if(u.coefficient>0&&i.selected_node.direction=="product"||u.coefficient<0&&i.selected_node.direction=="reactant")u.index==e?(u.is_primary=!0,t=o):u.is_primary=!1,u=b(u,e,n.angle,n.main_axis,n.center,n.dis)}var a;s?(i.selected_node.metabolite_id=t,a=x(i.selected_node.metabolite_id,i.selected_node.reaction_id),d(a)):(a=x(i.selected_node.metabolite_id,i.selected_node.reaction_id),p(a)),H([i.selected_node.reaction_id])}function C(e){i.selected_node.metabolite_id=e.metabolite_id,i.selected_node.direction=e.coefficient>0?"product":"reactant",i.selected_node.is_selected=!0,i.selected_node.reaction_id=e.reaction_id,d(S()),P()}function k(e){var t=e.append("g").attr("class","metabolite-group").attr("id",function(e){return e.metabolite_id}),r=function(){var e=n.select(this),t=i.drawn_reactions[e.datum().reaction_id].metabolites[e.datum().metabolite_id],r=v({x:n.event.dx,y:n.event.dy});t.dis=v({x:t.dis.x+n.event.dx,y:t.dis.y+n.event.dy});var s=n.transform(e.attr("transform"));e.attr("transform","translate("+(s.translate[0]+n.event.dx)+","+(s.translate[1]+n.event.dy)+")"+"scale("+s.scale+")")},s=function(){n.event.sourceEvent.stopPropagation()},o=function(){var e=n.select(this),t=n.transform(e.attr("transform"));e.attr("transform",null),B([e.datum().reaction_id])};t.append("path").attr("class","reaction-arrow");var u=t.append("g").attr("class","circle-and-label");u.append("circle").attr("class","metabolite-circle").on("click",C).call(n.behavior.drag().on("dragstart",s).on("drag",r).on("dragend",o)),u.append("text").attr("class","metabolite-label").text(function(e){return e.metabolite_id}).attr("pointer-events","none")}function L(e){e.selectAll(".reaction-arrow").datum(function(){return this.parentNode.__data__}).attr("d",function(e){return"M"+e.start.x+","+e.start.y+"C"+e.b1.x+","+e.b1.y+" "+e.b2.x+","+e.b2.y+" "+e.end.x+","+e.end.y}).attr("marker-end",function(e){var t=e.flux?i.scale.flux_color(Math.abs(e.flux)):i.default_reaction_color,n=F(t,!0);return"url(#"+n+")"}).style("stroke",function(e){var t=e.flux?i.scale.flux_color(Math.abs(e.flux)):i.default_reaction_color;return t});var t=e.selectAll(".circle-and-label").datum(function(){return this.parentNode.__data__}).attr("transform",function(e){return"translate("+e.circle.x+","+e.circle.y+")"}),n=function(e){return e.reaction_id==i.selected_node.reaction_id&&e.metabolite_id==i.selected_node.metabolite_id&&i.selected_node.is_selected?!0:!1};t.select(".metabolite-circle").attr("r",function(e){return e.r}).style("stroke",function(e){return n(e)?"#222":null}).style("stroke-width",function(e){return n(e)?"3px":null}),t.select(".metabolite-label").attr("transform",function(e){return"translate("+e.text_dis.x+","+e.text_dis.y+")"})}function A(e){e.append("text").attr("class","reaction-label").attr("pointer-events","none")}function O(e){var t=function(e,t){return e>(t-45)*Math.PI/180&&e<(t+45)*Math.PI/180};e.text(function(e){return e.reaction_id+" ("+i.decimal_format(e.flux)+")"}).attr("transform",function(e){var n;t(e.angle,90)?n={x:30,y:-35}:t(e.angle,180)?n={x:-20,y:0}:t(e.angle,270)?n={x:-30,y:35}:t(e.angle,0)&&(n={x:20,y:0});var r=g({x:e.center.x+n.x,y:e.center.y+n.y},e.angle,e.main_axis[0]);return"translate("+r.x+","+r.y+")"})}function M(e){var t=e.append("g").attr("id",function(e){return e.reaction_id}).attr("class","reaction").attr("transform",function(e){return"translate("+e.coords.x+","+e.coords.y+")"}).call(A);return}function _(e){e.select(".reaction-label").call(O);var t=e.selectAll(".metabolite-group").data(function(e){return D(e.metabolites,"metabolite_id")},function(e){return e.metabolite_id});t.enter().call(k),t.call(L),t.exit().remove();return}function D(e,t){var n=[];for(var r in e){var i=$.extend(!0,{},e[r]);i[t]=r,n.push(i)}return n}function P(){var e=n.select("#reactions").selectAll(".reaction").data(D(i.drawn_reactions,"reaction_id"),function(e){return e.reaction_id});e.enter().call(M),e.call(_),e.exit().remove()}function H(e){var t={},r=-1;while(++r<e.length)t[e[r]]=$.extend(!0,{},i.drawn_reactions[e[r]]);e.length!=Object.keys(t).length&&console.warn("did not find correct reaction subset");var s=n.select("#reactions").selectAll(".reaction").data(D(t,"reaction_id"),function(e){return e.reaction_id});s.enter().call(M),s.call(_)}function B(e){var t=i.drawn_reactions[e],n,r;t=y(t);for(var s in t.metabolites){var o=t.metabolites[s];o.coefficient<0&&(o.is_primary?n=o.index:o.is_primary&&(r=o.index))}for(s in t.metabolites){o=t.metabolites[s];var u;o.coefficient<0?u=n:u=r,o=b(o,u,t.angle,t.main_axis,t.center,t.dis)}H([e]),p(S())}function j(e,t,n){i.drawn_reactions[e][t]=n}function F(e,t){var n;t?n="start-":n="end-";var r=String(e).replace("#",n);if(i.arrowheads_generated.indexOf(r)<0){i.arrowheads_generated.push(r);var s=5,o=5,u,a=s/2,f;t?u=0:u=o,t?f="M0,0 V"+s+" L"+o/2+","+s/2+" Z":f="M"+o+",0 V"+s+" L"+o/2+","+s/2+" Z";var l=i.svg.select("defs");l.empty()&&(l=i.svg.append("svg:defs")),l.append("svg:marker").attr("id",r).attr("class","arrowhead").attr("refX",u).attr("refY",a).attr("markerWidth",s).attr("markerHeight",o).attr("orient","auto").append("svg:path").attr("d",f).style("fill",e)}return r}function I(){var e=80,t=32,r={left:37,right:39,up:38,down:40};n.select(window).on("keydown",function(){var s=n.event.keyCode,o=$("#rxn-input").is(":focus");s==e&&!o?T():s==t?o?$("#rxn-input").blur():$("#rxn-input").focus():s==r.left&&!o?(j(i.selected_node.reaction_id,"angle",270*(Math.PI/180)),B(i.selected_node.reaction_id)):s==r.right&&!o?(j(i.selected_node.reaction_id,"angle",90*(Math.PI/180)),B(i.selected_node.reaction_id)):s==r.up&&!o?(j(i.selected_node.reaction_id,"angle",180*(Math.PI/180)),B(i.selected_node.reaction_id)):s==r.down&&!o&&(j(i.selected_node.reaction_id,"angle",0),B(i.selected_node.reaction_id))})}var i=e.set_options(r,{margins:{top:10,right:10,bottom:10,left:20},selection:n.select("body").append("div"),selection_is_svg:!1,fillScreen:!1,update_hook:!1,css_path:"css/metabolic-map.css",map_path:"data/maps/simpheny-maps/ijo-central.json",flux_path:!1,flux2_path:!1,css:""});i.selection_is_svg&&console.error("Builder does not support placement within svg elements");var s=e.setup_svg(i.selection,i.selection_is_svg,i.margins,i.fill_screen);i.svg=s.svg,i.height=s.height,i.width=s.width,i.reaction_input=l(i.selection);var o=[{file:i.css_path,callback:u},{file:i.map_path,callback:a},{file:i.flux_path,callback:function(e,t){f(e,t,0)}},{file:i.flux2_path,callback:function(e,t){f(e,t,1)}}];return e.load_files(o,c),{update:c}}}),n("main",["vis/bar","vis/box-and-whiskers","vis/category-legend","vis/data-menu","vis/epistasis","vis/export-svg","vis/histogram","vis/resize","vis/scatter","vis/subplot","vis/tooltip","metabolic-map/main","metabolic-map/knockout","builder/main"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return{bar:e,box_and_whiskers:t,category_legend:n,data_menu:r,epistasis:i,export_svg:s,histogram:o,resize:u,scatter:a,subplot:f,tooltip:l,metabolic_map:c,builder:p,knockout:h}}),t("main")});